\usepackage{environ}
\usepackage{xargs}
\usepackage{ifthen}
\usepackage{xifthen}

\usepackage{amsmath}
\usepackage{amssymb}
%\usepackage{eulervm} ?
\usepackage{stmaryrd}
\usepackage{nccmath} %? decreases spacing around equations etc.
\usepackage{mathtools}
\usepackage{float}
\usepackage{varwidth}
\usepackage{bussproofs}


\newcommand{\parens}[1]{\left(#1\right)}

\newcommand{\grmr}{\ ::=&\ \ }
\newcommand{\altn}{\\ \big|&\ \ }
\newcommand{\alt}{\ \big|\ }

\newcommand{\reduction}{\longrightarrow}

\newcommand{\oprv}{\operatorname{rv}}
\newcommand{\opdv}{\operatorname{dv}}
\newcommand{\opfv}{\operatorname{fv}}
\newcommand{\rv}[1]{\oprv(#1)} % received
\newcommand{\dv}[1]{\opdv(#1)} % defined
\newcommand{\fv}[1]{\opfv(#1)} % free
\newcommand{\oprn}{\operatorname{rn}}
\newcommand{\opbn}{\operatorname{bn}}
\newcommand{\opfn}{\operatorname{fn}}
\newcommand{\rn}[1]{\oprn(#1)} % received
\newcommand{\bn}[1]{\opbn(#1)} % bound
\newcommand{\fn}[1]{\opfn(#1)} % free
\newcommand{\names}[1]{\operatorname{n}(#1)}


% pi calculus
\newcommand{\pnullproc}{\textbf{0}}
\newcommand{\ppar}{\ |\ }
\newcommand{\prep}[1]{!#1}
\newcommand{\pnew}{\@ifstar{\@pnewp}{\@pnewn}}
\newcommand{\@pnewp}[2]{(\nu #1)\parens{#2}}
\newcommand{\@pnewn}[2]{(\nu #1)#2}
\newcommand{\psnd}[2]{\overline{#1}#2}
\newcommand{\prcv}[2]{#1(#2)}
\newcommand{\pchc}{+}

% join calculus
\newcommand{\jsnd}[2]{#1\langle#2\rangle}
\newcommand{\jdef}[2]{\textbf{def} \ #1 \ \textbf{in} \ #2}
\newcommand{\jpar}{ | }
\newcommand{\jnullproc}{\textbf{0}}
\newcommand{\jrct}[2]{#1 \vartriangleright #2}
\newcommand{\jcon}{\wedge}
\newcommand{\jnulldef}{\boldsymbol{\top}}
\newcommand{\jrcv}[2]{#1\langle#2\rangle}
\newcommand{\jpat}{\jpar}
% locations
\newcommand{\jloc}[3]{#1 \left[ #2 : #3 \right]}
\newcommand{\jgo}[2]{\operatorname{go} \langle #1, #2 \rangle}

% CHAM
\newcommand{\rchamreduction}{\longrightarrow}
\newcommand{\rchamheating}{\rightleftharpoons}

\newcommand{\rchamequ}[3]{&(\text{#1}) & #2 & &\ \ \rchamheating &\ #3 & &}
\newcommand{\rchamred}[3]{&(\text{#1}) & #2 & &\ \rchamreduction &\ #3 & &}
\newcommand{\rchamcnf}{\@ifstar{\@rchamcnfaligned}{\@rchamcnfunaligned}}
\newcommand{\@rchamcnfaligned}[2]{#1 &\vdash #2}
\newcommand{\@rchamcnfunaligned}[2]{#1 \vdash #2}
\newcommand{\rchamcnfset}{\@ifstar{\@rchamcnfsetaligned}{\@rchamcnfsetunaligned}}
\newcommand{\@rchamcnfsetaligned}[2]{\{#1\} &\vdash \{#2\}}
\newcommand{\@rchamcnfsetunaligned}[2]{\{#1\} \vdash \{#2\}}

\newcommand{\drchamequ}[4]{&(\text{#1}) & #3 &\ \ \rchamheating &\ &#4 & #2&}
\newcommand{\drchamred}[4]{&(\text{#1}) & #3 &\ \rchamreduction &\ &#4 & #2&}
\newcommand{\drchamcnf}[3]{#2 \vdash_{#1} #3}
\newcommand{\drchampar}{\ \ ||\ \ }

\newcommand{\joinreduction}{\longrightarrow_J}


% actor pi
\newcommand{\anullproc}{\textbf{0}}
\newcommand{\arcv}[2]{#1(#2)}
\newcommand{\asnd}[2]{\overline{#1}\langle#2\rangle}
\newcommand{\anew}{\@ifstar{\@anewp}{\@anewn}}
\newcommand{\@anewp}[2]{(\nu #1)\parens{#2}}
\newcommand{\@anewn}[2]{(\nu #1)#2}
\newcommand{\apar}{\ |\ }
\newcommand{\acse}[2]{\textbf{case} \ #1 \ \textbf{of} \ \parens{#2}}
\newcommand{\aalt}[2]{#1 : #2}
\newcommand{\ains}[3]{#1 \langle #2 ; #3 \rangle}
\newcommand{\adef}{\@ifstar{\@adefa}{\@adefn}}
\newcommand{\@adefa}[4]{#1 &\overset{\mathclap{\mathit{def}}}{=} \left( #2 ; #3 \right) #4}
\newcommand{\@adefn}[4]{#1 \overset{\mathit{def}}{=} \left( #2 ; #3 \right) #4}

% type judgement
\newcommand{\ch}[1]{ch(#1)}
\newcommand{\restrict}[2]{#1 |_{#2}}

\newcommand{\judgement}[3]{%
  \ifthenelse{\isempty{#1}}{\emptyset}{#1}%
  ;\ifthenelse{\isempty{#2}}{\{\}}{#2}%
  \vdash #3}

% semantics
\newcommand{\apireduction}[1]{\overset{#1}{\longrightarrow}}

\newcommand{\actsilent}{\tau}
\newcommand{\actoutfree}[2]{\overline{#1}#2}
\newcommand{\actoutbound}[2]{\overline{#1}(#2)}
\newcommand{\actinfree}[2]{#1#2}
\newcommand{\actinbound}[2]{#1(#2)}


\newcommand{\substitution}[1]{[ #1 ]}
\newcommand{\subst}[2]{#1 / #2}

\newcommand{\abbreviation}[2]{#1 \ \ &\text{for} \ \ #2}


% encoding
\newcommand{\encMJtoAP}[1]{\llbracket #1 \rrbracket}


% bussproofs
\newcommand{\axiom}[1]{\AxiomC{$#1$}}
\newcommand{\infI}[2]{\LeftLabel{\textsc{#1}:}\UnaryInfC{$#2$}}
\newcommand{\infII}[2]{\LeftLabel{\textsc{#1}:}\BinaryInfC{$#2$}}
% TODO: number argument

\newcommand{\infrulecondition}[1]{%
  \ifthenelse{\isempty{#1}}{}{
    \RightLabel{if #1}
  }
}

\newcommand{\axiomrule}[3]{%
  \infrule{#1}{#2}{}{#3}
}
\newcommand{\infrule}[4]{%
  \begin{prooftree}
    \AxiomC{$#3$}
    \LeftLabel{\textsc{#1} : }
    \infrulecondition{#2}
    \UnaryInfC{$#4$}
  \end{prooftree}
}
\newcommand{\infruleII}[5]{
  \begin{prooftree}
    \AxiomC{$#3$}
    \AxiomC{$#4$}
    \LeftLabel{\textsc{#1} : }
    \infrulecondition{#2}
    \BinaryInfC{$#5$}
  \end{prooftree}
}
\newcommand{\infruleIII}[6]{
  \begin{prooftree}
    \AxiomC{$#3$}
    \AxiomC{$#4$}
    \AxiomC{$#5$}
    \LeftLabel{\textsc{#1} : }
    \infrulecondition{#2}
    \TrinaryInfC{$#6$}
  \end{prooftree}
}
