\section{The \JoinCalc}

% short introduction?
% or in thesis introduction?

% grammar

We define \joincalc in accordance with Fournet et al.
\cite{fournet_calculus_1996}.
Assuming an infinite set of channel names
$ \mathcal{N} = \{ x, y, z, u, v, \kappa, \ldots \} $,
we use
$ \tilde{x}, \tilde{y}, \ldots $
for tuples of names

% TODO:
% turn into figure again?
% left-align explanations?
\begin{align}
  \tag*{\textbf{processes}}
  \\
  P, Q
  \grmr \jsnd{x}{\tilde{v}}   \tag*{emission of $\tilde{v}$ on $x$}
  \altn \nonumber \jdef{D}{P} \tag*{definition of D in P}
  \altn P \jpar Q             \tag*{parallel composition}
  \altn \jnullproc            \tag*{empty process}
  \\ \nonumber
  \\
  \tag*{\textbf{definitions}}
  \\
  D, E
  \grmr \jrct{J}{P} \tag*{elementary clause}
  \altn D \jcon E   \tag*{simultaneous definitions}
  \altn \jnulldef   \tag*{empty definition}
  \\ \nonumber
  \\
  \tag*{\textbf{join-patterns}}
  \\
  J, K
  \grmr \jrcv{x}{\tilde{v}} \tag*{reception of $\tilde{v}$ on x}
  \altn J \jpat K           \tag*{composed join-pattern}
\end{align}

Note that received names in a join-pattern must be all different,
making both patterns
$ \jrcv{x}{u,u} $ and
$ \jrcv{x}{u} \jpat \jrcv{y}{u} $
invalid.

% TODO: some explanations?

% TODO: scopes, defined names?

\begin{alignat*}{2}
  & \rv{\jrcv{x}{\tilde{v}}} & &= \{ u \in \tilde{v} \} \\
  & \rv{J \jpat K}           & &= \rv{J} \uplus \rv{K} \\
  \\
  & \dv{\jrcv{x}{\tilde{v}}} & &= \{ x \} \\
  & \dv{J \jpat K}           & &= \dv{J} \cup \dv{K} \\
  \\
  & \dv{\jrct{J}{P}}         & &= \dv{J} \\
  & \dv{D \jcon E}           & &= \dv{D} \cup \dv{E} \\
  & \dv{\jnulldef}           & &= \emptyset \\
  \\
  & \fv{\jrct{J}{P}}         & &= \dv{J} \cup (\fv{P} - \rv{J}) \\
  & \fv{D \jcon E}           & &= \fv{D} \cup \fv{E} \\
  & \fv{\jnulldef}           & &= \emptyset \\
  \\
  & \fv{\jsnd{x}{v}}         & &= \{ x \} \cup \{ u \in \tilde{v} \} \\
  & \fv{\jdef{D}{P}}         & &= (\fv{P} \cup \fv{D}) - \dv{D} \\
  & \fv{P \jpat Q}           & &= \fv{P} \cup \fv{Q} \\
  & \fv{\jnullproc}          & &= \emptyset \\
\end{alignat*}


% semantics

% RCHAM
% \cite{berry_chemical_1990}?
The semantics of \joincalc is described using the reflexive chemical abstract
machine (RCHAM) \cite{fournet_reflexive_1996}.
A RCHAM configuration
$ \mathcal{R} \vdash \mathcal{M} $
consists of a multiset of active definitions $\mathcal{R}$,
called ``reactions",
and a multiset of active processes $\mathcal{M}$,
called ``molecules".

There are multiple reversible heating/cooling rules $\rchamheating$,
corresponding to the structural equivalence between processes,
and a single reduction rule $\rchamreduction$.
In each of these rules, there is an implicit unchanged context of reactions and
molecules which is omitted for brevity.

\begin{align*}
  \rchamequ{str-join}{
    \rchamcnf{}{P \jpar Q}
  }{
    \rchamcnf{}{P, Q}
  }
  \\
  \rchamequ{str-null}{
    \rchamcnf{}{\jnullproc}
  }{
    \rchamcnf{}{}
  }
  \\
  \rchamequ{str-and}{
    \rchamcnf{D \jcon E}{}
  }{
    \rchamcnf{D, E}{}
  }
  \\
  \rchamequ{str-nodef}{
    \rchamcnf{\jnulldef}{}
  }{
    \rchamcnf{}{}
  }
  \\
  \rchamequ{str-def}{
    \rchamcnf{}{\jdef{D}{P}}
  }{
    \rchamcnf{D\sigma_{\opdv}}{P\sigma_{\opdv}}
  }
  \\
  \\
  \rchamred{red}{
    \rchamcnf{\jrct{J}{P}}{J\sigma_{\oprv}}
  }{
    \rchamcnf{\jrct{J}{P}}{P\sigma_{\oprv}}
  }
\end{align*}

In (str-dev), the substitution $\sigma_{\opdv}$ instantiates the defined
variables $\dv{D}$ to distinct, fresh names that are not in the free variables
of any reaction or molecule in the configuration.
In (red), $\sigma_{\oprv}$ simply substitutes the received variables $\rv{J}$.
Note that (red) makes use of the syntactic similarity between join-patterns
and parallel emission of messages in processes.

% examples?

\subsection{The Core \JoinCalc}

The full calculus can be encoded in the core calculus,
which provides a simpler basis to work with.

\begin{JDef}{grammar of \monadicjoincalc}
  P, Q
  \grmr \jsnd{x}{u}
  \altn P \jpar Q
  \altn \jdef{\jrct{\jrcv{x}{u} \jpat \jrcv{y}{v}}{P}}{Q}
\end{JDef}


\subsection{The \JoinCalc with Locations}

\cite{fournet_calculus_1996}

% short explanation of idea

infinite set of location names
$ \mathcal{L} = \{ a, b, c, \ldots \} $

These can also be sent and received:
$ v \in \mathcal{N} \cup \mathcal{L} $


\begin{JDef}{grammar of the \joincalc with locations}
  P, Q
  \grmr \dots
  \altn \jgo{b}{\kappa}
  \\ \\
  D, E
  \grmr \dots
  \altn \jloc{a}{D}{P}
\end{JDef}

Two syntactic restrictions:
\begin{itemize}
  \item a location $a$ can only be defined once in any definition $D$
  \item a defined channel $x$ may only appear in the join patterns of one location
\end{itemize}

\begin{align*}
  \drchamred{comm}{(x \in \dv{J})}{
    \drchamcnf{\phi}{}{\jsnd{x}{\tilde{v}}}
    \drchampar
    \drchamcnf{}{\jrct{J}{P}}{}
  }{
    \drchamcnf{\phi}{}{}
    \drchampar
    \drchamcnf{}{\jrct{J}{P}}{\jsnd{x}{\tilde{v}}}
  }
  \\
  \drchamequ{str-loc}{(a \ \text{frozen)}}{
    \drchamcnf{\phi}{\jloc{a}{D}{P}}{}
  }{
    \drchamcnf{\phi}{}{}
    \drchampar
    \drchamcnf{\phi a}{D}{P}
  }
  \\
  \drchamred{move}{}{
    \drchamcnf{\phi}{\jloc{a}{D}{P \jpar \jgo{b}{\kappa}}}{}
    \drchampar
    \drchamcnf{\psi b}{}{}
  }{
    \drchamcnf{\phi}{}{}
    \drchampar
    \drchamcnf{\psi b}{\jloc{a}{D}{P \jpar \jsnd{\kappa}{}}}{}
  }
\end{align*}
